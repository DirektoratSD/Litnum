<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Pendampingan</title>
    <script src="https://cdn.tailwindcss.com"></script>
  	<link rel="icon" type="image/x-icon" href="https://kemendikdasmen.go.id/web/image/website/21/favicon?unique=c3563e4">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Menggunakan font Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style kustom untuk scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1ff;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- ================================== -->
    <!-- MODAL LOGIN (Tidak Berubah) -->
    <!-- ================================== -->
    <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md transform transition-all">
            <div class="text-center mb-6">
                <i class="fas fa-clipboard-list text-4xl text-blue-600 mb-3"></i>
                <h2 class="text-3xl font-bold text-gray-800">Login Pendampingan</h2>
                <p class="text-gray-600 mt-2">Silakan pilih wilayah Anda untuk melanjutkan.</p>
            </div>
            
            <div class="space-y-4">
                <!-- 1. Dropdown Provinsi -->
                <div>
                    <label for="login-provinsi" class="block text-sm font-medium text-gray-700 mb-1">Provinsi</label>
                    <select id="login-provinsi" class="mt-1 block w-full px-3 py-3 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <option value="">Memuat provinsi...</option>
                    </select>
                </div>
                
                <!-- 2. Dropdown Kab/Kota (Tersembunyi) -->
                <div id="login-kab-kota-wrapper" class="hidden">
                    <label for="login-kab-kota" class="block text-sm font-medium text-gray-700 mb-1">Kabupaten/Kota</label>
                    <select id="login-kab-kota" class="mt-1 block w-full px-3 py-3 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <option value="">Pilih Kab/Kota</option>
                    </select>
                </div>
                
                <!-- 3. Password (Dihapus) -->
                
                <!-- Pesan Error -->
                <p id="login-error" class="text-red-600 text-sm text-center h-4"></p>
                
                <!-- 4. Tombol Login -->
                <button id="login-button" class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-150 disabled:bg-gray-400" disabled>
                    <i class="fas fa-sign-in-alt mr-2"></i> Masuk
                </button>
            </div>
        </div>
    </div>
    <!-- ================================== -->
    <!-- AKHIR MODAL LOGIN -->
    <!-- ================================== -->


    <!-- Kontainer aplikasi utama (Tidak Berubah) -->
    <div id="app-container" class="flex h-screen hidden">
        <aside id="sidebar" class="w-64 bg-gray-800 text-white p-4 flex-shrink-0 fixed md:relative h-full z-20 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
            <!-- Navigasi Sidebar (Tidak Berubah) -->
            <div class="h-16 flex items-center justify-center mb-4">
                <i class="fas fa-clipboard-list text-2xl mr-3"></i>
                <h1 class="text-2xl font-bold text-white">Pendampingan</h1>
            </div>
            <nav>
                <ul class="space-y-2">
                    <li>
                        <a href="#" onclick="showForm('fgd-form', this)" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                            <i class="fas fa-users w-6 text-center mr-3"></i>
                            <span class="font-medium">FGD</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showForm('wawancara-guru-form', this)" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors"> <i class="fas fa-chalkboard-user w-6 text-center mr-3"></i>
                            <span class="font-medium">Wawancara Guru</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showForm('wawancara-murid-form', this)" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                            <i class="fas fa-children w-6 text-center mr-3"></i>
                            <span class="font-medium">Wawancara Murid</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showForm('observasi-form', this)" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                            <i class="fas fa-eye w-6 text-center mr-3"></i>
                            <span class="font-medium">Observasi</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showForm('observasi-form', this)" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                            <i class="fas fa-eye w-6 text-center mr-3"></i>
                            <span class="font-medium">Program</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showForm('observasi-form', this)" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                            <i class="fas fa-eye w-6 text-center mr-3"></i>
                            <span class="font-medium">Laporan</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showForm('observasi-form', this)" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                            <i class="fas fa-eye w-6 text-center mr-3"></i>
                            <span class="font-medium">Panduan Diskusi</span>
                        </a>
                    </li>                   
                    <li>
                        <a href="./" class="sidebar-link flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition-colors">
                            <i class="fas fa-home w-6 text-center mr-3"></i>
                            <span class="font-medium">Home</span>
                        </a>
                    </li>                         
                </ul>
            </nav>
        </aside>

        <div id="overlay" class="fixed inset-0 bg-black opacity-50 z-10 hidden md:hidden"></div>

        <div id="main-content" class="flex-1 flex flex-col overflow-hidden">
            <header class="md:hidden bg-white shadow p-4 flex justify-between items-center">
                <h1 class="text-xl font-bold text-gray-800">Form Pendampingan</h1>
                <button id="menu-toggle" class="text-gray-700 focus:outline-none">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </header>

            <main class="flex-1 overflow-y-auto p-6 md:p-8">

                <!-- ================================== -->
                <!-- FORM WAWANCARA GURU -->
                <!-- ================================== -->
                <div id="wawancara-guru-form" class="form-section hidden">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Form Wawancara Guru</h1>
                    
                    <form id="form-wawancara-guru" method="POST">
                        <!-- Data Petugas & Sekolah (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">I. Data Petugas & Sekolah</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 data-sekolah-grid">
                                <!-- Konten diisi oleh createSchoolSelectors() -->
                                <div>
                                    <label for="petugas1" class="block text-sm font-medium text-gray-700 mb-1">Petugas 1</label>
                                    <select id="petugas1" name="petugas1" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="petugas2" class="block text-sm font-medium text-gray-700 mb-1">Petugas 2</label>
                                    <select id="petugas2" name="petugas2" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="npsn" class="block text-sm font-medium text-gray-700 mb-1">NPSN</label>
                                    <input type="text" name="npsn" id="npsn" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="nama_sekolah" class="block text-sm font-medium text-gray-700 mb-1">Nama Sekolah</label>
                                    <input type="text" name="nama_sekolah" id="nama_sekolah" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="provinsi" class="block text-sm font-medium text-gray-700 mb-1">Provinsi</label>
                                    <input type="text" name="provinsi" id="provinsi" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="kab_kota" class="block text-sm font-medium text-gray-700 mb-1">Kab/Kota</label>
                                    <input type="text" name="kab_kota" id="kab_kota" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Data Guru (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">II. Data Guru</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="nama_guru" class="block text-sm font-medium text-gray-700 mb-1">Nama Guru</label>
                                    <input type="text" name="nama_guru" id="nama_guru" placeholder="Masukkan Nama Guru" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="hp_guru" class="block text-sm font-medium text-gray-700 mb-1">HP Guru</label>
                                    <input type="tel" name="hp_guru" id="hp_guru" placeholder="Mis: 08123456..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_guru" class="block text-sm font-medium text-gray-700 mb-1">Mengajar Kelas</label>
                                    <input type="text" name="kelas_guru" id="kelas_guru" placeholder="Mis: Kelas 1 dan 2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Pertanyaan Wawancara (Kosong) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">III. Pertanyaan Wawancara</h2>
                            <!-- Konten akan diisi oleh JS -->
                            <div id="wawancara-guru-questions" class="space-y-8">
                                <!-- Konten dinamis -->
                            </div>
                        </div>

                        <!-- Tombol Submit (Tidak Berubah) -->
                        <div class="mt-8 flex justify-end gap-4">
                            <button type="button" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-150">
                                <i class="fas fa-print mr-2"></i> Cetak
                            </button>
                            <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-150 disabled:bg-gray-400">
                                <i class="fas fa-save mr-2"></i> Simpan Wawancara
                            </button>
                        </div>
                    </form>
                </div>

                <!-- ================================== -->
                <!-- FORM FGD -->
                <!-- ================================== -->
                <div id="fgd-form" class="form-section">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Form FGD</h1>
                    
                    <form id="form-fgd" method="POST">
                        <!-- Data Petugas & Sekolah (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">I. Data Petugas & Sekolah</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 data-sekolah-grid">
                                <div>
                                    <label for="petugas1_fgd" class="block text-sm font-medium text-gray-700 mb-1">Petugas 1</label>
                                    <select id="petugas1_fgd" name="petugas1_fgd" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="petugas2_fgd" class="block text-sm font-medium text-gray-700 mb-1">Petugas 2</label>
                                    <select id="petugas2_fgd" name="petugas2_fgd" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="npsn_fgd" class="block text-sm font-medium text-gray-700 mb-1">NPSN</label>
                                    <input type="text" name="npsn_fgd" id="npsn_fgd" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="nama_sekolah_fgd" class="block text-sm font-medium text-gray-700 mb-1">Nama Sekolah</label>
                                    <input type="text" name="nama_sekolah_fgd" id="nama_sekolah_fgd" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="provinsi_fgd" class="block text-sm font-medium text-gray-700 mb-1">Provinsi</label>
                                    <input type="text" name="provinsi_fgd" id="provinsi_fgd" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="kab_kota_fgd" class="block text-sm font-medium text-gray-700 mb-1">Kab/Kota</label>
                                    <input type="text" name="kab_kota_fgd" id="kab_kota_fgd" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Data Peserta FGD (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">II. Data Peserta FGD</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="nama_kepala_sekolah" class="block text-sm font-medium text-gray-700 mb-1">Nama Kepala Sekolah</label>
                                    <input type="text" name="nama_kepala_sekolah" id="nama_kepala_sekolah" placeholder="Masukkan Nama Kepala Sekolah" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="hp_kepala_sekolah" class="block text-sm font-medium text-gray-700 mb-1">HP Kepala Sekolah</label>
                                    <input type="tel" name="hp_kepala_sekolah" id="hp_kepala_sekolah" placeholder="Mis: 08123456..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="lama_bertugas" class="block text-sm font-medium text-gray-700 mb-1">Lama Bertugas</label>
                                    <input type="text" name="lama_bertugas" id="lama_bertugas" placeholder="Mis: 2 tahun 5 bulan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div class="md:col-span-2"></div> <div>
                                    <label for="nama_guru_fgd" class="block text-sm font-medium text-gray-700 mb-1">Nama Guru</label>
                                    <input type="text" name="nama_guru_fgd" id="nama_guru_fgd" placeholder="Masukkan Nama Guru" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="hp_guru_fgd" class="block text-sm font-medium text-gray-700 mb-1">HP Guru</label>
                                    <input type="tel" name="hp_guru_fgd" id="hp_guru_fgd" placeholder="Mis: 08123456..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_guru_fgd" class="block text-sm font-medium text-gray-700 mb-1">Mengajar Kelas</label>
                                    <input type="text" name="kelas_guru_fgd" id="kelas_guru_fgd" placeholder="Mis: Kelas 1 dan 2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Pertanyaan FGD (Kosong) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">III. Pertanyaan FGD</h2>
                            <!-- Konten akan diisi oleh JS -->
                            <div id="fgd-questions" class="space-y-8">
                                <!-- Konten dinamis -->
                            </div>

                            <!-- Catatan Pelaksanaan (Tidak Berubah) -->
                            <div class="mt-8 border-t pt-6">
                                <h3 class="text-lg font-semibold text-gray-700 mb-3">Catatan Pelaksanaan:</h3>
                                <ul class="text-sm text-gray-600 list-disc list-inside space-y-1">
                                    <li>(1) wawancara dilaksanakan dalam durasi maksimal 30 menit secara individual;</li>
                                    <li>(2) gunakan pertanyaan probe untuk memperdalam jawaban tanpa mengarahkan;</li>
                                    <li>(3) catat kutipan kunci, temuan penting, dan bukti verifikasi;</li>
                                    <li>(4) hasil wawancara menjadi dasar triangulasi dengan wawancara guru dan hasil observasi kelas.</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Tombol Submit (Tidak Berubah) -->
                        <div class="mt-8 flex justify-end gap-4">
                            <button type="button" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-150">
                                <i class="fas fa-print mr-2"></i> Cetak
                            </button>
                            <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-150 disabled:bg-gray-400">
                                <i class="fas fa-save mr-2"></i> Simpan FGD
                            </button>
                        </div>
                    </form>
                </div>

                <!-- ================================== -->
                <!-- FORM WAWANCARA MURID -->
                <!-- ================================== -->
                <div id="wawancara-murid-form" class="form-section hidden">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Form Wawancara Murid</h1>
                    
                    <form id="form-wawancara-murid" method="POST">
                        <!-- Data Petugas & Sekolah (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">I. Data Petugas & Sekolah</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 data-sekolah-grid">
                                <div>
                                    <label for="petugas1_murid" class="block text-sm font-medium text-gray-700 mb-1">Petugas 1</label>
                                    <select id="petugas1_murid" name="petugas1_murid" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="petugas2_murid" class="block text-sm font-medium text-gray-700 mb-1">Petugas 2</label>
                                    <select id="petugas2_murid" name="petugas2_murid" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="npsn_murid" class="block text-sm font-medium text-gray-700 mb-1">NPSN</label>
                                    <input type="text" name="npsn_murid" id="npsn_murid" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="nama_sekolah_murid" class="block text-sm font-medium text-gray-700 mb-1">Nama Sekolah</label>
                                    <input type="text" name="nama_sekolah_murid" id="nama_sekolah_murid" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="provinsi_murid" class="block text-sm font-medium text-gray-700 mb-1">Provinsi</label>
                                    <input type="text" name="provinsi_murid" id="provinsi_murid" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="kab_kota_murid" class="block text-sm font-medium text-gray-700 mb-1">Kab/Kota</label>
                                    <input type="text" name="kab_kota_murid" id="kab_kota_murid" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Data Murid (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">II. Data Murid</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <div>
                                    <label for="nama_murid_1" class="block text-sm font-medium text-gray-700 mb-1">Nama Murid 1</label>
                                    <input type="text" name="nama_murid_1" id="nama_murid_1" placeholder="Masukkan Nama Murid 1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_murid_1" class="block text-sm font-medium text-gray-700 mb-1">Kelas (Murid 1)</label>
                                    <input type="text" name="kelas_murid_1" id="kelas_murid_1" placeholder="Mis: 4B" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="nama_murid_2" class="block text-sm font-medium text-gray-700 mb-1">Nama Murid 2</label>
                                    <input type="text" name="nama_murid_2" id="nama_murid_2" placeholder="Masukkan Nama Murid 2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_murid_2" class="block text-sm font-medium text-gray-700 mb-1">Kelas (Murid 2)</label>
                                    <input type="text" name="kelas_murid_2" id="kelas_murid_2" placeholder="Mis: 5A" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="nama_murid_3" class="block text-sm font-medium text-gray-700 mb-1">Nama Murid 3</label>
                                    <input type="text" name="nama_murid_3" id="nama_murid_3" placeholder="Masukkan Nama Murid 3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_murid_3" class="block text-sm font-medium text-gray-700 mb-1">Kelas (Murid 3)</label>
                                    <input type="text" name="kelas_murid_3" id="kelas_murid_3" placeholder="Mis: 1C" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="nama_murid_4" class="block text-sm font-medium text-gray-700 mb-1">Nama Murid 4</label>
                                    <input type="text" name="nama_murid_4" id="nama_murid_4" placeholder="Masukkan Nama Murid 4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_murid_4" class="block text-sm font-medium text-gray-700 mb-1">Kelas (Murid 4)</label>
                                    <input type="text" name="kelas_murid_4" id="kelas_murid_4" placeholder="Mis: 2B" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="nama_murid_5" class="block text-sm font-medium text-gray-700 mb-1">Nama Murid 5</label>
                                    <input type="text" name="nama_murid_5" id="nama_murid_5" placeholder="Masukkan Nama Murid 5" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_murid_5" class="block text-sm font-medium text-gray-700 mb-1">Kelas (Murid 5)</label>
                                    <input type="text" name="kelas_murid_5" id="kelas_murid_5" placeholder="Mis: 3A" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="nama_murid_6" class="block text-sm font-medium text-gray-700 mb-1">Nama Murid 6</label>
                                    <input type="text" name="nama_murid_6" id="nama_murid_6" placeholder="Masukkan Nama Murid 6" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_murid_6" class="block text-sm font-medium text-gray-700 mb-1">Kelas (Murid 6)</label>
                                    <input type="text" name="kelas_murid_6" id="kelas_murid_6" placeholder="Mis: 6B" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Pertanyaan Wawancara (Kosong) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">III. Pertanyaan Wawancara</h2>
                            <!-- Konten akan diisi oleh JS -->
                            <div id="wawancara-murid-questions" class="space-y-8">
                                <!-- Konten dinamis -->
                            </div>
                        </div>

                        <!-- Tombol Submit (Tidak Berubah) -->
                        <div class="mt-8 flex justify-end gap-4">
                            <button type="button" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-150">
                                <i class="fas fa-print mr-2"></i> Cetak
                            </button>
                            <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-150 disabled:bg-gray-400">
                                <i class="fas fa-save mr-2"></i> Simpan Wawancara Murid
                            </button>
                        </div>
                    </form>
                </div>

                <!-- ================================== -->
                <!-- FORM OBSERVASI -->
                <!-- ================================== -->
                <div id="observasi-form" class="form-section hidden">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Form Observasi</h1>
                    
                    <form id="form-observasi" method="POST">
                        <!-- Data Petugas & Sekolah (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">I. Data Petugas & Sekolah</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 data-sekolah-grid">
                                <div>
                                    <label for="petugas1_obs" class="block text-sm font-medium text-gray-700 mb-1">Petugas 1</label>
                                    <select id="petugas1_obs" name="petugas1_obs" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="petugas2_obs" class="block text-sm font-medium text-gray-700 mb-1">Petugas 2</label>
                                    <select id="petugas2_obs" name="petugas2_obs" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                        <option value="">Pilih Petugas</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="npsn_obs" class="block text-sm font-medium text-gray-700 mb-1">NPSN</label>
                                    <input type="text" name="npsn_obs" id="npsn_obs" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="nama_sekolah_obs" class="block text-sm font-medium text-gray-700 mb-1">Nama Sekolah</label>
                                    <input type="text" name="nama_sekolah_obs" id="nama_sekolah_obs" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="provinsi_obs" class="block text-sm font-medium text-gray-700 mb-1">Provinsi</label>
                                    <input type="text" name="provinsi_obs" id="provinsi_obs" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                                <div>
                                    <label for="kab_kota_obs" class="block text-sm font-medium text-gray-700 mb-1">Kab/Kota</label>
                                    <input type="text" name="kab_kota_obs" id="kab_kota_obs" placeholder="Pilih sekolah dari dropdown..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-gray-50" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Data Guru (Observasi) (Tidak Berubah) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg mb-6">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">II. Data Guru (Observasi)</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="nama_guru_obs" class="block text-sm font-medium text-gray-700 mb-1">Nama Guru</label>
                                    <input type="text" name="nama_guru_obs" id="nama_guru_obs" placeholder="Masukkan Nama Guru" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="hp_guru_obs" class="block text-sm font-medium text-gray-700 mb-1">HP Guru</label>
                                    <input type="tel" name="hp_guru_obs" id="hp_guru_obs" placeholder="Mis: 08123456..." class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                                <div>
                                    <label for="kelas_guru_obs" class="block text-sm font-medium text-gray-700 mb-1">Mengajar Kelas</label>
                                    <input type="text" name="kelas_guru_obs" id="kelas_guru_obs" placeholder="Mis: Kelas 1 dan 2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Observasi (Struktur Tabel) -->
                        <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg">
                            <h2 class="text-2xl font-semibold text-gray-700 mb-6 border-b pb-3">III. Observasi</h2>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full border border-gray-300 border-collapse">
                                    <!-- Header Tabel (Tidak Berubah) -->
                                    <thead class="bg-gray-100 text-gray-700">
                                        <tr>
                                            <th rowspan="2" class="border border-gray-300 p-3 text-left text-sm font-semibold w-1/12">No</th>
                                            <th rowspan="2" class="border border-gray-300 p-3 text-left text-sm font-semibold w-4/12">Komponen dan Indikator</th>
                                            <th colspan="3" class="border border-gray-300 p-3 text-center text-sm font-semibold w-3/12">Pengamatan</th>
                                            <th rowspan="2" class="border border-gray-300 p-3 text-left text-sm font-semibold w-4/12">Catatan & Bukti Pendukung</th>
                                        </tr>
                                        <tr>
                                            <th class="border border-gray-300 p-2 text-center text-xs font-medium w-1/12">Ya</th>
                                            <th class="border border-gray-300 p-2 text-center text-xs font-medium w-1/12">Tidak</th>
                                            <th class="border border-gray-300 p-2 text-center text-xs font-medium w-1/12">Tdk. Teramati</th>
                                        </tr>
                                    </thead>
                                    
                                    <!-- tbody (Kosong) -->
                                    <tbody id="observasi-tbody">
                                        <!-- Konten dinamis -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Tombol Submit (Tidak Berubah) -->
                        <div class="mt-8 flex justify-end gap-4">
                            <button type="button" class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-all duration-150">
                                <i class="fas fa-print mr-2"></i> Cetak
                            </button>
                            <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-150 disabled:bg-gray-400">
                                <i class="fas fa-save mr-2"></i> Simpan Observasi
                            </button>
                        </div>
                    </form>
                </div>

            </main>
        </div>
    </div>

    <!-- Modal Feedback Simpan Data (Tidak Berubah) -->
    <div id="feedback-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm text-center">
            <div id="modal-loading" class="space-y-3">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-500"></i>
                <h3 class="text-lg font-medium text-gray-800">Menyimpan...</h3>
                <p class="text-sm text-gray-600">Mohon tunggu, data sedang dikirim.</p>
            </div>
            <div id="modal-success" class="hidden space-y-3">
                <i class="fas fa-check-circle text-4xl text-green-500"></i>
                <h3 class="text-lg font-medium text-gray-800">Berhasil Disimpan</h3>
                <p class="text-sm text-gray-600">Data Anda telah berhasil direkam.</p>
                <button id="modal-close-btn" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 w-full">Tutup</button>
            </div>
            <div id="modal-error" class="hidden space-y-3">
                <i class="fas fa-times-circle text-4xl text-red-500"></i>
                <h3 class="text-lg font-medium text-gray-800">Gagal Menyimpan</h3>
                <p id="modal-error-message" class="text-sm text-gray-600">Terjadi kesalahan. Silakan coba lagi.</p>
                <button id="modal-error-close-btn" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 w-full">Tutup</button>
            </div>
        </div>
    </div>


    <script>
        // Logika JavaScript untuk Sidebar dan Navigasi Form
        // (Kode ini sudah ada dan tidak diubah)
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menu-toggle');
        const overlay = document.getElementById('overlay');
        const formSections = document.querySelectorAll('.form-section');
        const sidebarLinks = document.querySelectorAll('.sidebar-link');

        function showForm(formId, clickedLink) {
            formSections.forEach(form => {
                form.classList.add('hidden');
            });
            const activeForm = document.getElementById(formId);
            if (activeForm) {
                activeForm.classList.remove('hidden');
            }
            sidebarLinks.forEach(link => {
                link.classList.remove('bg-gray-900', 'text-white');
                link.classList.add('text-gray-300', 'hover:bg-gray-700', 'hover:text-white');
            });
            if (clickedLink) {
                clickedLink.classList.add('bg-gray-900', 'text-white');
                clickedLink.classList.remove('text-gray-300', 'hover:bg-gray-700');
            }
            if (window.innerWidth < 768) {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });
        overlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        });

        // Set form default saat aplikasi dimuat (setelah login)
        function setDefaultForm() {
            const defaultFormId = 'fgd-form';
            const defaultLink = document.querySelector('a[onclick*="fgd-form"]');
            showForm(defaultFormId, defaultLink);
        }
    </script>

    <script type="module">
        // ==================================
        // IMPOR MODUL
        // ==================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            getDocs, 
            setLogLevel,
            addDoc,
            serverTimestamp,
            doc,
            getDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // ==================================
        // DATA PERTANYAAN (STATIS)
        // (Data dari Pertanyaan.js)
        // ==================================
        
        // 1. WAWANCARA GURU
        const guruQuestions = [
            {
                id: 'q1',
                label: '1. Bagaimana Bapak/Ibu memahami penguatan literasi dan numerasi dalam konteks pembelajaran mendalam? [Pemahaman Umum]',
                probe: [
                    '- Apa perbedaan penguatan literasi dan numerasi dengan kegiatan membaca atau berhitung yang selama ini dilakukan?',
                    '- Bagaimana penguatan tersebut berkontribusi pada pengembangan dimensi Profil Lulusan?'
                ],
                placeholder: 'Guru menunjukkan pemahaman bahwa literasi dan numerasi merupakan kemampuan berpikir, bernalar, dan memahami konteks secara mendalam dalam setiap mata pelajaran. Jawaban mencerminkan keterkaitan antara penguatan literasi dan numerasi dengan pembentukan kompetensi murid sesuai dimensi Profil Lulusan.'
            },
            {
                id: 'q2',
                label: '2. Bagaimana Bapak/Ibu menilai kemampuan literasi dan numerasi murid di kelas yang Bapak/Ibu ampu berdasarkan pengalaman mengajar dan data pembelajaran? [Kondisi Awal dan Refleksi Sekolah]',
                probe: [
                    '- Apakah Bapak/Ibu menggunakan hasil asesmen seperti ANBK atau asesmen diagnostik untuk memahami kemampuan murid?',
                    '- Apa yang menjadi kekuatan dan tantangan murid dalam literasi dan numerasi?'
                ],
                placeholder: 'Guru mampu menjelaskan kondisi aktual berdasarkan data atau observasi kelas. Jawaban menggambarkan kemampuan guru dalam mengenali capaian murid serta tantangan yang perlu ditangani melalui strategi pembelajaran yang sesuai.'
            },
            {
                id: 'q3',
                label: '3. Dapatkah Bapak/Ibu menceritakan contoh pembelajaran yang telah diterapkan untuk memperkuat kemampuan literasi dan numerasi murid? [Praktik Pembelajaran dan Strategi Inovatif]',
                probe: [
                    '- Bagaimana Bapak/Ibu menggunakan pertanyaan pemantik (SSA) atau pendekatan CPA dalam proses pembelajaran?',
                    '- Adakah kegiatan membaca, menulis, atau berhitung yang dikaitkan dengan konteks kehidupan sehari-hari?'
                ],
                placeholder: 'Guru memberikan contoh konkret penerapan strategi pembelajaran mendalam seperti penggunaan pertanyaan pemantik (SSA), tahapan konkretvisualabstrak (CPA), atau integrasi literasi-numerasi kontekstual. Jawaban menunjukkan keterlibatan aktif murid dalam proses berpikir dan refleksi'
            },
            {
                id: 'q4',
                label: '4. Bagaimana bentuk kolaborasi yang dilakukan Bapak/Ibu bersama guru lain untuk memperkuat pembelajaran yang menguatkan literasi dan numerasi di sekolah? [Kolaborasi dan Pengembangan Profesional]',
                probe: [
                    '- Adakah forum pertemuan atau diskusi rutin untuk berbagi praktik pembelajaran?',
                    '- Bagaimana hasil kolaborasi tersebut diterapkan dalam kegiatan belajar di kelas?'
                ],
                placeholder: 'Guru menjelaskan keterlibatan dalam kegiatan kolaboratif seperti MGMP internal, lesson study, refleksi kolektif, atau forum pengembangan profesi. Jawaban menunjukkan adanya budaya saling belajar dan penguatan kapasitas guru melalui praktik bersama.'
            },
            {
                id: 'q5',
                label: '5. Bagaimana Bapak/Ibu memanfaatkan media, sumber belajar, atau teknologi digital untuk mendukung literasi dan numerasi? [Pemanfaatan Media dan Sumber Belajar]',
                probe: [
                    '- Media atau sumber belajar apa yang paling membantu murid memahami konsep secara mendalam?',
                    '- Bagaimana Bapak/Ibu menyesuaikan media pembelajaran dengan tingkat kemampuan murid?'
                ],
                placeholder: 'Guru menjelaskan penggunaan media atau sumber belajar yang kontekstual dan variatif, seperti teks bacaan tematik, alat peraga numerasi, video, atau platform digital. Jawaban menunjukkan kreativitas guru dalam memfasilitasi pengalaman belajar bermakna.'
            },
            {
                id: 'q6',
                label: '6. Bagaimana Bapak/Ibu melakukan refleksi terhadap hasil pembelajaran literasi dan numerasi murid? [Refleksi dan Evaluasi Pembelajaran]',
                probe: [
                    '- Apakah terdapat forum refleksi setelah pembelajaran untuk meninjau hasil dan strategi?',
                    '- Bagaimana hasil refleksi digunakan untuk perbaikan proses belajar berikutnya?'
                ],
                placeholder: 'Guru menunjukkan adanya kesadaran reflektif terhadap hasil belajar murid. Jawaban menggambarkan praktik evaluasi formatif dan tindak lanjut konkret seperti penyesuaian strategi, pemberian umpan balik, atau penguatan materi.'
            },
            {
                id: 'q7',
                label: '7. Apa yang menurut Bapak/Ibu perlu diperkuat agar pelaksanaan program penguatan literasi dan numerasi di kelas dapat berjalan optimal? [Kesiapan dan Dukungan Implementasi]',
                probe: [
                    '- Dukungan atau pelatihan apa yang paling dibutuhkan untuk memperkuat kompetensi mengajar?',
                    '- Bagaimana peran Kepala Sekolah dan rekan guru dalam memberikan dukungan tersebut?'
                ],
                placeholder: 'Guru menjelaskan kebutuhan penguatan kapasitas profesional, dukungan fasilitas, serta mekanisme kolaboratif dari sekolah. Jawaban mencerminkan kesiapan pribadi dan kelembagaan untuk melaksanakan program secara berkelanjutan.'
            }
        ];

        // 2. WAWANCARA MURID
        const muridQuestions = [
            {
                id: 'mq1',
                label: '1. Ceritakan kegiatan belajar di sekolah yang menurut kamu paling membantu memahami pelajaran. [Pengalaman Belajar]',
                probe: [
                    '- Apa yang membuat kegiatan itu mudah kamu pahami atau kamu sukai?',
                    '- Siapa yang biasanya membimbing atau membantu kamu saat kegiatan itu berlangsung?'
                ],
                placeholder: 'Murid menceritakan pengalaman belajar yang berkesan, seperti membaca cerita, membuat proyek sederhana, berdiskusi, atau memecahkan soal dengan cara menyenangkan. Jawaban menunjukkan keterlibatan aktif murid dalam proses belajar yang bermakna.'
            },
            {
                id: 'mq2',
                label: '2. Apakah kamu sering membaca atau menulis di sekolah? Kegiatan seperti apa yang paling kamu sukai? [Kegiatan Literasi]',
                probe: [
                    '- Bacaan seperti apa yang paling menarik untuk kamu baca di sekolah?',
                    '- Apakah kamu pernah diminta menulis atau menceritakan kembali hasil bacaanmu?'
                ],
                placeholder: 'Murid menjelaskan kegiatan literasi yang rutin atau menarik, misalnya membaca di pojok baca, menulis cerita, membuat ringkasan bacaan, atau diskusi tentang isi teks. Jawaban menggambarkan bahwa murid terlibat aktif dan memahami isi bacaan.'
            },
            {
                id: 'mq3',
                label: '3. Ceritakan pengalamanmu saat belajar berhitung atau memecahkan masalah angka di sekolah. [Kegiatan Numerasi]',
                probe: [
                    '- Pernahkah kamu menggunakan benda nyata, gambar, atau permainan saat belajar berhitung?',
                    '- Bagaimana cara guru menjelaskan supaya kamu bisa lebih paham?'
                ],
                placeholder: 'Murid menggambarkan pengalaman belajar numerasi yang menyenangkan, seperti menghitung dengan alat peraga, menggambar grafik, atau bermain peran dalam menyelesaikan soal. Jawaban menunjukkan adanya penerapan tahapan konkretvisualabstrak dalam pembelajaran numerasi.'
            },
            {
                id: 'mq4',
                label: '4. Setelah belajar, apakah kamu biasanya diminta untuk menulis atau bercerita tentang apa yang kamu pelajari? [Refleksi Belajar]',
                probe: [
                    '- Apa yang biasanya kamu tulis atau ceritakan?',
                    '- Bagaimana perasaanmu ketika diminta menceritakan kembali pelajaran yang sudah kamu pelajari?'
                ],
                placeholder: 'Murid menjelaskan bahwa refleksi menjadi bagian dari proses belajar, seperti menulis jurnal belajar, menyampaikan pendapat di depan kelas, atau menuliskan hal baru yang dipahami. Jawaban menunjukkan kemampuan murid untuk merefleksikan pengalaman belajar.'
            },
            {
                id: 'mq5',
                label: '5. Bagaimana suasana belajar di kelas kamu? Apakah ada hal di sekolah yang membuat kamu senang belajar membaca atau berhitung? [Lingkungan dan Suasana Belajar]',
                probe: [
                    '- Apakah kamu punya tempat favorit untuk membaca atau belajar?',
                    '- Apa yang biasanya dilakukan guru supaya suasana belajar terasa menyenangkan?'
                ],
                placeholder: 'Murid menggambarkan suasana kelas yang mendukung, seperti guru yang sabar, kegiatan kelompok yang seru, atau ruang baca yang menarik. Jawaban menunjukkan bahwa lingkungan belajar di sekolah memberi dukungan terhadap pembiasaan yang menguatkan literasi dan numerasi'
            },
            {
                id: 'mq6',
                label: '6. Menurut kamu, apa kegiatan belajar yang paling kamu tunggu atau paling membuat kamu bersemangat di sekolah? [Keterlibatan dan Motivasi]',
                probe: [
                    '- Mengapa kamu menyukai kegiatan itu?',
                    '- Apakah kegiatan itu membuat kamu merasa lebih paham pelajaran?'
                ],
                placeholder: 'Murid menyampaikan kegiatan belajar yang menumbuhkan semangat, seperti proyek, eksperimen, permainan, atau membaca bersama. Jawaban menunjukkan bahwa pembelajaran di sekolah membantu membangun motivasi dan rasa percaya diri murid.'
            }
        ];

        // 3. FGD (KEPALA SEKOLAH & GURU)
        const fgdQuestions = [
            {
                label: '1. Bagaimana Bapak/Ibu memahami penguatan literasi dan numerasi dalam konteks pembelajaran mendalam di sekolah? [Pemahaman Umum]',
                probe: [
                    '- Bagaimana keterkaitan antara penguatan literasi dan numerasi dengan dimensi Profil Lulusan?',
                    '- Bagaimana konsep ini diterapkan dalam proses pembelajaran di kelas?'
                ],
                fields: [
                    { id: 'fgd_q1_ks', label: 'Jawaban Kepala Sekolah:', placeholder: 'Konteks: Kepala Sekolah menunjukkan pemahaman yang komprehensif bahwa literasi dan numerasi merupakan kemampuan esensial yang dikembangkan melalui pembelajaran berkesadaran, bermakna, dan menggembirakan. Jawaban mencerminkan pemahaman tentang hubungan antara pembelajaran mendalam dan penguatan kemampuan murid dalam berbagai mata pelajaran.' },
                    { id: 'fgd_q1_guru', label: 'Jawaban Guru:', placeholder: 'Konteks: Guru menunjukkan pemahaman bahwa literasi dan numerasi merupakan kemampuan berpikir, bernalar, dan memahami konteks secara mendalam dalam setiap mata pelajaran. Jawaban mencerminkan keterkaitan antara penguatan literasi dan numerasi dengan pembentukan kompetensi murid sesuai dimensi Profil Lulusan.' }
                ]
            },
            {
                label: '2. Berdasarkan hasil refleksi atau data Rapor Pendidikan, tantangan apa yang saat ini dihadapi sekolah dalam meningkatkan kemampuan literasi dan numerasi murid? [Kondisi Awal dan Refleksi Sekolah]',
                probe: [
                    '- Apakah tantangan tersebut berkaitan dengan aspek pedagogik, lingkungan belajar, atau kebijakan sekolah?',
                    '- Data atau hasil asesmen apa yang digunakan sekolah untuk memahami kondisi tersebut?'
                ],
                fields: [
                    { id: 'fgd_q2_ks', label: 'Jawaban Kepala Sekolah:', placeholder: 'Konteks: Kepala Sekolah dapat menjelaskan kondisi aktual dengan mengacu pada data asesmen seperti ANBK, asesmen diagnostik, atau hasil refleksi guru. Jawaban menunjukkan kemampuan analitis dalam mengidentifikasi akar tantangan serta dampaknya terhadap proses pembelajaran.' },
                    { id: 'fgd_q2_guru', label: 'Jawaban Guru:', placeholder: 'Konteks: Guru mampu menjelaskan kondisi aktual berdasarkan data atau observasi kelas. Jawaban menggambarkan kemampuan guru dalam mengenali capaian murid serta tantangan yang perlu ditangani melalui strategi pembelajaran yang sesuai.' }
                ]
            },
            {
                label: '3. Langkah apa yang telah dilakukan Sekolah untuk mendukung guru dalam mengembangkan pembelajaran yang menguatkan literasi dan numerasi? [Kepemimpinan Instruksional]',
                probe: [
                    '- Bagaimana bentuk supervisi akademik atau pendampingan yang diberikan kepada guru?',
                    '- Apakah terdapat forum refleksi, pelatihan, atau kebijakan internal yang mendukung penerapan strategi pembelajaran mendalam seperti SSA atau CPA?'
                ],
                fields: [
                    { id: 'fgd_q3', label: 'Catatan FGD (KS & Guru):', placeholder: 'Konteks: Kepala Sekolah dan guru menjelaskan perannya dalam membina dan memfasilitasi guru melalui kegiatan supervisi, forum pengembangan profesi, atau kebijakan akademik sekolah. Jawaban memperlihatkan keselarasan antara kepemimpinan instruksional dan peningkatan kualitas pembelajaran.' }
                ]
            },
            {
                label: '4. Dapatkah Bapak/Ibu menceritakan contoh pembelajaran yang telah diterapkan untuk memperkuat kemampuan literasi dan numerasi murid? [Praktik Pembelajaran dan Strategi Inovatif]',
                probe: [
                    '- Bagaimana Bapak/Ibu menggunakan pertanyaan pemantik (SSA) atau pendekatan CPA dalam proses pembelajaran?',
                    '- Adakah kegiatan membaca, menulis, atau berhitung yang dikaitkan dengan konteks kehidupan sehari-hari?'
                ],
                fields: [
                    { id: 'fgd_q4', label: 'Catatan FGD (KS & Guru):', placeholder: 'Konteks: Kepala Sekolah dan Guru memberikan contoh konkret penerapan strategi pembelajaran mendalam seperti penggunaan pertanyaan pemantik (SSA), tahapan konkretvisualabstrak (CPA), atau integrasi literasi-numerasi kontekstual. Jawaban menunjukkan keterlibatan aktif murid dalam proses berpikir dan refleksi.' }
                ]
            },
            {
                label: '5. Bagaimana sekolah membangun budaya kolaboratif untuk memperkuat literasi dan numerasi lintas mata pelajaran? [Kolaborasi dan Budaya Sekolah]',
                probe: [
                    '- Adakah forum atau kegiatan rutin yang memfasilitasi guru berbagi praktik pembelajaran literasi dan numerasi?',
                    '- Bagaimana hasil kolaborasi tersebut digunakan untuk meningkatkan mutu pembelajaran?'
                ],
                fields: [
                    { id: 'fgd_q5_ks', label: 'Jawaban Kepala Sekolah:', placeholder: 'Konteks: Kepala Sekolah menggambarkan keberadaan forum kolaboratif seperti MGMP internal, lesson study, atau pertemuan reflektif guru. Budaya kerja kolaboratif di sekolah mendorong konsistensi penerapan strategi literasi dan numerasi secara lintas disiplin.' },
                    { id: 'fgd_q5_guru', label: 'Jawaban Guru:', placeholder: 'Konteks: Guru menjelaskan keterlibatan dalam kegiatan kolaboratif seperti MGMP internal, lesson study, refleksi kolektif, atau forum pengembangan profesi. Jawaban menunjukkan adanya budaya saling belajar dan penguatan kapasitas guru melalui praktik bersama.' }
                ]
            },
            {
                label: '6. Bagaimana sekolah mengoptimalkan sumber daya dan lingkungan belajar untuk mendukung penguatan literasi dan numerasi? [Pemanfaatan Sumber Daya dan Lingkungan Belajar]',
                probe: [
                    '- Apakah sekolah memiliki fasilitas atau sarana yang mendukung kegiatan literasi dan numerasi, seperti pojok baca, papan data, atau media numerasi?',
                    '- Bagaimana sekolah memanfaatkan media digital dan alat bantu pembelajaran lainnya?',
                    '- Media atau sumber belajar apa yang paling membantu murid memahami konsep secara mendalam?'
                ],
                fields: [
                    { id: 'fgd_q6_ks', label: 'Jawaban Kepala Sekolah:', placeholder: 'Konteks: Kepala Sekolah dan guru menjelaskan ketersediaan serta pemanfaatan fasilitas dan sumber daya sekolah untuk memperkuat budaya literasi dan numerasi. Jawaban menekankan upaya penciptaan lingkungan belajar yang kaya sumber daya dan kondusif bagi pembelajaran mendalam.' },
                    { id: 'fgd_q6_guru', label: 'Jawaban Guru:', placeholder: 'Konteks: Kepala sekolah dan guru menjelaskan penggunaan media atau sumber belajar yang kontekstual dan variatif, seperti teks bacaan tematik, alat peraga numerasi, video, atau platform digital. Jawaban menunjukkan kreativitas guru dalam memfasilitasi pengalaman belajar bermakna.' }
                ]
            },
            {
                label: '7. Bagaimana sekolah melaksanakan evaluasi dan refleksi terhadap pelaksanaan program literasi dan numerasi? [Evaluasi dan Refleksi Program]',
                probe: [
                    '- Siapa yang terlibat dalam proses refleksi hasil pembelajaran?',
                    '- Bagaimana hasil refleksi digunakan sebagai dasar penyempurnaan pembelajaran berikutnya?'
                ],
                fields: [
                    { id: 'fgd_q7', label: 'Catatan FGD (KS & Guru):', placeholder: 'Konteks: Kepala Sekolah dan guru menjelaskan adanya mekanisme refleksi terstruktur, melibatkan guru dan tim pengembang sekolah. Hasil refleksi digunakan untuk menyusun perbaikan strategi pembelajaran dan kebijakan penguatan literasi dan numerasi.' }
                ]
            },
            {
                label: '8. Menjelang tahap implementasi program penguatan literasi dan numerasi, hal apa yang perlu diperkuat agar pelaksanaan program berjalan optimal? [Kesiapan Implementasi dan Tindak Lanjut]',
                probe: [
                    '- Apakah ada kebutuhan tambahan dari sisi sumber daya manusia, pelatihan, atau dukungan kelembagaan?',
                    '- Langkah tindak lanjut apa yang akan dilakukan sekolah untuk menjaga keberlanjutan program?'
                ],
                fields: [
                    { id: 'fgd_q8', label: 'Catatan FGD (KS & Guru):', placeholder: 'Konteks: Kepala Sekolah dan guru menyampaikan analisis kesiapan sekolah dan rencana tindak lanjut, termasuk penguatan kapasitas guru, dukungan sumber daya, dan mekanisme monitoring. Jawaban menunjukkan komitmen terhadap pelaksanaan program secara berkelanjutan.' }
                ]
            }
        ];

        // 4. OBSERVASI KELAS
        const observasiItems = {
            prosesPembelajaran: [
                { id: 'obs_a1', no: 1, indicator: 'Kegiatan Pembuka', description: 'Guru menjelaskan tujuan pembelajaran dan mengaitkannya dengan pengalaman nyata murid.', notesId: 'catatan_a1' },
                { id: 'obs_a2', no: 2, indicator: 'Aktivasi yang Menguatkan Literasi', description: 'Terdapat kegiatan membaca, menulis, atau berdiskusi yang membantu murid memahami konteks pembelajaran.', notesId: 'catatan_a2' },
                { id: 'obs_a3', no: 3, indicator: 'Aktivasi yang Menguatkan Numerasi', description: 'Guru memberikan kegiatan yang melatih berpikir logis, berhitung, mengukur, atau menganalisis data sederhana.', notesId: 'catatan_a3' },
                { id: 'obs_a4', no: 4, indicator: 'Pertanyaan Pemantik (SSA)', description: 'Guru menggunakan pertanyaan yang mendorong murid berpikir pada tiga tingkat: memahami isi, menafsirkan makna, dan menilai informasi.', notesId: 'catatan_a4' },
                { id: 'obs_a5', no: 5, indicator: 'Tahapan CPA (Concrete Pictorial Abstract)', description: 'Guru memfasilitasi pembelajaran yang berpindah dari benda konkret, representasi gambar, hingga simbol/konsep abstrak.', notesId: 'catatan_a5' },
                { id: 'obs_a6', no: 6, indicator: 'Keterlibatan Murid', description: 'Murid aktif bertanya, menjawab, dan berpartisipasi dalam kegiatan belajar.', notesId: 'catatan_a6' },
                { id: 'obs_a7', no: 7, indicator: 'Kegiatan Reflektif', description: 'Di akhir pembelajaran, murid melakukan refleksi atau menyimpulkan hasil belajarnya.', notesId: 'catatan_a7' },
                { id: 'obs_a8', no: 8, indicator: 'Pemanfaatan Media / Teknologi', description: 'Guru menggunakan media visual, alat peraga, atau teknologi digital untuk memperjelas pembelajaran (dengan strategi yang menguatkan literasi dan numerasi).', notesId: 'catatan_a8' },
                { id: 'obs_a9', no: 9, indicator: 'Diferensiasi Pembelajaran', description: 'Guru menyesuaikan kegiatan atau contoh pembelajaran dengan kemampuan dan kebutuhan murid yang beragam.', notesId: 'catatan_a9' },
                { id: 'obs_a10', no: 10, indicator: 'Penilaian Formatif', description: 'Guru memberikan umpan balik langsung terhadap hasil kerja murid selama kegiatan belajar berlangsung.', notesId: 'catatan_a10' }
            ],
            kondisiLingkungan: [
                { id: 'obs_b1', no: 1, indicator: 'Lingkungan Kelas yang Menguatkan Literasi', description: 'Terdapat bahan bacaan (yang sesuai dengan pembacanya) di kelas seperti buku, poster, atau karya tulis murid yang mendukung budaya literasi.', notesId: 'catatan_b1' },
                { id: 'obs_b2', no: 2, indicator: 'Lingkungan Kelas yang Menguatkan Numerasi', description: 'Ada alat bantu atau tampilan yang memperkuat pemahaman numerasi seperti grafik, tabel, atau data hasil proyek.', notesId: 'catatan_b2' },
                { id: 'obs_b3', no: 3, indicator: 'Pojok Baca / Sudut Literasi', description: 'Kelas memiliki area khusus untuk membaca atau menulis.', notesId: 'catatan_b3' },
                { id: 'obs_b4', no: 4, indicator: 'Paparan Karya Murid', description: 'Karya tulis, hasil proyek, atau refleksi murid ditampilkan di ruang kelas atau koridor sekolah.', notesId: 'catatan_b4' },
                { id: 'obs_b5', no: 5, indicator: 'Kebersihan dan Kerapian Ruang Belajar', description: 'Ruang kelas tertata dengan baik, ventilasi cukup, dan suasana mendukung konsentrasi belajar.', notesId: 'catatan_b5' },
                { id: 'obs_b6', no: 6, indicator: 'Fasilitas Pendukung Sekolah', description: 'Sekolah memiliki fasilitas pendukung literasi-numerasi seperti perpustakaan, laboratorium, atau ruang multimedia.', notesId: 'catatan_b6' },
                { id: 'obs_b7', no: 7, indicator: 'Kegiatan Literasi Sekolah', description: 'Terlihat adanya kegiatan literasi terjadwal (misalnya membaca bersama, hari literasi, atau jurnal pagi).', notesId: 'catatan_b7' },
                { id: 'obs_b8', no: 8, indicator: 'Kegiatan Numerasi Sekolah', description: 'Ada aktivitas numerasi di luar kelas seperti permainan edukatif, proyek data, atau lomba numerasi.', notesId: 'catatan_b8' },
                { id: 'obs_b9', no: 9, indicator: 'Keterlibatan Kepala Sekolah dan Guru', description: 'Kepala sekolah dan guru aktif memantau serta memberi dukungan terhadap kegiatan literasi dan numerasi.', notesId: 'catatan_b9' },
                { id: 'obs_b10', no: 10, indicator: 'Suasana Sekolah yang Mendorong Belajar', description: 'Lingkungan sekolah menampilkan poster edukatif, slogan motivasi, atau simbol yang mendorong semangat belajar.', notesId: 'catatan_b10' }
            ]
        };


        // ==================================
        // KONFIGURASI FIREBASE
        // ==================================
        const firebaseConfig = {
            apiKey: "AIzaSyDxH9Do9ecrEHW8sNxfpGjLUQ3qP14ONGM",
            authDomain: "litnum2025.firebaseapp.com",
            projectId: "litnum2025",
            storageBucket: "litnum2025.firebasestorage.app",
            messagingSenderId: "233586560867",
            appId: "1:233586560867:web:2800372b3a62dde68a8d56"
        };

        // ==================================
        // INISIALISASI
        // ==================================
        let db;
        let allSekolahData = [];
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            setLogLevel('debug');
        } catch (e) {
            console.error("Error inisialisasi Firebase:", e);
        }

        // ==================================
        // FUNGSI HELPER BARU: Penghitung Kata
        // ==================================
        /**
         * Menghitung jumlah kata dalam sebuah string.
         * @param {string} str String yang akan dihitung katanya.
         * @returns {number} Jumlah kata.
         */
        function countWords(str) {
            if (!str || str.trim() === '') {
                return 0;
            }
            // Memecah string berdasarkan satu atau lebih spasi (termasuk baris baru)
            return str.trim().split(/\s+/).length;
        }


        // ==================================
        // FUNGSI GENERATOR HTML (MODIFIKASI)
        // ==================================

        function generateStandardQuestions(questions) {
            let html = '';
            questions.forEach(q => {
                const probes = q.probe.map(p => `${p}<br>`).join('');
                html += `
                    <div>
                        <label for="${q.id}" class="block text-md font-semibold text-gray-800">${q.label}</label>
                        <p class="text-sm text-gray-600 mt-2 mb-3">
                            <strong class="text-gray-700">Probe:</strong><br>
                            ${probes}
                        </p>
                        <textarea id="${q.id}" name="${q.id}" rows="6" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200" placeholder="${q.placeholder}"></textarea>
                        
                        <!-- MODIFIKASI: Tambah penghitung kata untuk Wawancara Guru -->
                        <div class="text-sm text-gray-600 text-right mt-1" id="counter_${q.id}">0 kata</div>
                    </div>
                `;
            });
            return html;
        }

        function generateFgdQuestions(questions) {
            let html = '';
            questions.forEach(q => {
                const probes = q.probe.map(p => `${p}<br>`).join('');
                html += `<div>
                    <label class="block text-md font-semibold text-gray-800">${q.label}</label>
                    <p class="text-sm text-gray-600 mt-2 mb-3">
                        <strong class="text-gray-700">Probe:</strong><br>
                        ${probes}
                    </p>
                `;
                q.fields.forEach(field => {
                    html += `
                        <label for="${field.id}" class="block text-sm font-medium text-gray-700 mt-4 mb-1">${field.label}</label>
                        <textarea id="${field.id}" name="${field.id}" rows="5" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition-colors duration-200" placeholder="${field.placeholder}"></textarea>
                        
                        <!-- MODIFIKASI: Tambah penghitung kata untuk FGD -->
                        <div class="text-sm text-gray-600 text-right mt-1" id="counter_${field.id}">0 kata</div>
                    `;
                });
                html += `</div>`;
            });
            return html;
        }

        function generateObservasiSection(items, title) {
            let html = `
                <tr class="bg-gray-50">
                    <td colspan="6" class="border border-gray-300 p-3 font-bold text-gray-800">${title}</td>
                </tr>
            `;
            items.forEach(item => {
                html += `
                    <tr>
                        <td class="border border-gray-300 p-3 align-top text-center">${item.no}</td>
                        <td class="border border-gray-300 p-3 align-top text-sm">
                            ${item.indicator}<br>
                            <span class="text-xs text-gray-600">${item.description}</span>
                        </td>
                        <td class="border border-gray-300 p-3 align-middle text-center"><input type="radio" name="${item.id}" value="ya" class="h-4 w-4 text-blue-600"></td>
                        <td class="border border-gray-300 p-3 align-middle text-center"><input type="radio" name="${item.id}" value="tidak" class="h-4 w-4 text-blue-600"></td>
                        <td classm="border border-gray-300 p-3 align-middle text-center"><input type="radio" name="${item.id}" value="na" class="h-4 w-4 text-blue-600"></td>
                        <td class="border border-gray-300 p-3 align-top">
                            <textarea name="${item.notesId}" rows="3" class="w-full text-sm p-2 border border-gray-200 rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="Catatan..."></textarea>
                        </td>
                    </tr>
                `;
            });
            return html;
        }

        function populateAllForms() {
            try {
                // Wawancara Guru (form ini sekarang punya counter)
                const guruQuestionsContainer = document.getElementById('wawancara-guru-questions');
                if (guruQuestionsContainer) {
                    guruQuestionsContainer.innerHTML = generateStandardQuestions(guruQuestions);
                }
                
                // Wawancara Murid (form ini TIDAK punya counter)
                const muridQuestionsContainer = document.getElementById('wawancara-murid-questions');
                if (muridQuestionsContainer) {
                    // Kita buat fungsi generator terpisah untuk murid agar tidak ada counternya
                    let muridHTML = '';
                    muridQuestions.forEach(q => {
                        const probes = q.probe.map(p => `${p}<br>`).join('');
                        muridHTML += `
                            <div>
                                <label for="${q.id}" class="block text-md font-semibold text-gray-800">${q.label}</label>
                                <p class="text-sm text-gray-600 mt-2 mb-3">
                                    <strong class="text-gray-700">Probe:</strong><br>
                                    ${probes}
                                </p>
                                <textarea id="${q.id}" name="${q.id}" rows="6" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="${q.placeholder}"></textarea>
                            </div>
                        `;
                    });
                    muridQuestionsContainer.innerHTML = muridHTML;
                }
                
                // FGD (form ini sekarang punya counter)
                const fgdQuestionsContainer = document.getElementById('fgd-questions');
                if (fgdQuestionsContainer) {
                    fgdQuestionsContainer.innerHTML = generateFgdQuestions(fgdQuestions);
                }
                
                // Observasi
                const observasiTbody = document.getElementById('observasi-tbody');
                if (observasiTbody) {
                    const sectionA_HTML = generateObservasiSection(observasiItems.prosesPembelajaran, 'A. Proses Pembelajaran di Kelas');
                    const sectionB_HTML = generateObservasiSection(observasiItems.kondisiLingkungan, 'B. Kondisi Lingkungan Kelas dan Sekolah');
                    observasiTbody.innerHTML = sectionA_HTML + sectionB_HTML;
                }
            } catch (error) {
                console.error("Gagal mengisi form dinamis:", error);
            }
        }
        
        // ==================================
        // FUNGSI BARU: Setup Penghitung Kata
        // ==================================
        /**
         * Menambahkan event listener ke textarea FGD dan Wawancara Guru
         * untuk menghitung kata secara real-time.
         */
        function setupWordCounters() {
            // Hanya targetkan textarea di dalam form FGD dan Wawancara Guru
            const textareas = document.querySelectorAll(
                '#wawancara-guru-questions textarea, #fgd-questions textarea'
            );
            const MIN_WORDS = 300;

            textareas.forEach(textarea => {
                const counterId = 'counter_' + textarea.id;
                const counterEl = document.getElementById(counterId);
                
                if (counterEl) {
                    textarea.addEventListener('input', () => {
                        const words = countWords(textarea.value);
                        counterEl.textContent = `${words} kata`;
                        
                        // Beri feedback visual real-time
                        if (words < MIN_WORDS) {
                            counterEl.classList.add('text-red-600');
                            counterEl.classList.remove('text-green-600');
                            // Tambahkan border merah ke textarea
                            textarea.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                            textarea.classList.remove('border-gray-300', 'focus:border-blue-500', 'focus:ring-blue-500', 'border-green-500', 'focus:border-green-500', 'focus:ring-green-500');
                        } else {
                            counterEl.classList.remove('text-red-600');
                            counterEl.classList.add('text-green-600');
                            // Ganti border menjadi hijau jika sudah valid
                            textarea.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                            textarea.classList.add('border-green-500', 'focus:border-green-500', 'focus:ring-green-500');
                        }
                    });
                }
            });
        }


        // ==================================
        // LOGIKA APLIKASI (Tidak Berubah)
        // ==================================

        async function fetchData() {
            if (!db) {
                console.error("Firestore DB tidak terinisialisasi.");
                return;
            }
            try {
                const querySnapshot = await getDocs(collection(db, "sekolah"));
                allSekolahData = []; 
                querySnapshot.forEach((doc) => {
                    allSekolahData.push(doc.data());
                });
            } catch (error) {
                console.error("Error mengambil data sekolah:", error);
            }
        }

        function populatePetugasDropdowns() {
            const petugasSet = new Set();
            allSekolahData.forEach(s => {
                if (s.petugas1) petugasSet.add(s.petugas1);
                if (s.petugas2) petugasSet.add(s.petugas2);
            });
            const petugasList = [...petugasSet].sort();
            
            const allPetugasSelects = document.querySelectorAll('select[id^="petugas"]');
            allPetugasSelects.forEach(select => {
                while (select.options.length > 1) {
                    select.remove(1);
                }
                petugasList.forEach(nama => {
                    const option = document.createElement('option');
                    option.value = nama;
                    option.textContent = nama;
                    select.appendChild(option);
                });
            });
        }

        function createSchoolSelectors() {
            const allGrids = document.querySelectorAll('.data-sekolah-grid');
            
            allGrids.forEach((grid) => {
                const formId = grid.closest('.form-section').id;
                const selectorId = `schoolSelector_${formId}`;

                if (document.getElementById(selectorId)) return;

                const wrapperDiv = document.createElement('div');
                wrapperDiv.className = 'md:col-span-2'; 
                const label = document.createElement('label');
                label.htmlFor = selectorId;
                label.className = 'block text-sm font-medium text-gray-700 mb-1';
                label.textContent = 'Pilih Sekolah (Otomatis Isi Data)';
                const select = document.createElement('select');
                select.id = selectorId;
                select.name = selectorId;
                select.className = 'mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm';
                
                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "--- Pilih NPSN dan Nama Sekolah ---";
                select.appendChild(defaultOption);

                allSekolahData.sort((a, b) => a.npsn.localeCompare(b.npsn)).forEach(sekolah => {
                    const option = document.createElement('option');
                    option.value = sekolah.npsn; 
                    option.textContent = `${sekolah.npsn} - ${sekolah.sekolah}`;
                    select.appendChild(option);
                });

                select.addEventListener('change', handleSchoolSelect);
                wrapperDiv.appendChild(label);
                wrapperDiv.appendChild(select);
                grid.prepend(wrapperDiv);
            });
        }

        function handleSchoolSelect(event) {
            const selectedNPSN = event.target.value;
            const school = allSekolahData.find(s => s.npsn === selectedNPSN);
            const form = event.target.closest('.form-section');
            if (!form) return;

            const npsnInput = form.querySelector('input[id^="npsn"]');
            const sekolahInput = form.querySelector('input[id^="nama_sekolah"]');
            const provinsiInput = form.querySelector('input[id^="provinsi"]');
            const kotaInput = form.querySelector('input[id^="kab_kota"]');
            const petugas1Select = form.querySelector('select[id^="petugas1"]');
            const petugas2Select = form.querySelector('select[id^="petugas2"]');

            if (school) {
                if (npsnInput) npsnInput.value = school.npsn || '';
                if (sekolahInput) sekolahInput.value = school.sekolah || '';
                if (provinsiInput) provinsiInput.value = school.provinsi || '';
                if (kotaInput) kotaInput.value = school.kota || '';
                if (petugas1Select) petugas1Select.value = school.petugas1 || '';
                if (petugas2Select) petugas2Select.value = school.petugas2 || '';
            } else {
                if (npsnInput) npsnInput.value = '';
                if (sekolahInput) sekolahInput.value = '';
                if (provinsiInput) provinsiInput.value = '';
                if (kotaInput) kotaInput.value = '';
                if (petugas1Select) petugas1Select.value = '';
                if (petugas2Select) petugas2Select.value = '';
            }
        }

        // --- Modal (Tidak Berubah) ---
        const feedbackModal = document.getElementById('feedback-modal');
        const modalLoading = document.getElementById('modal-loading');
        const modalSuccess = document.getElementById('modal-success');
        const modalError = document.getElementById('modal-error');
        const modalErrorMessage = document.getElementById('modal-error-message');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalErrorCloseBtn = document.getElementById('modal-error-close-btn');

        function showLoadingModal() {
            modalLoading.classList.remove('hidden');
            modalSuccess.classList.add('hidden');
            modalError.classList.add('hidden');
            feedbackModal.classList.remove('hidden');
        }
        function showSuccessModal() {
            modalLoading.classList.add('hidden');
            modalSuccess.classList.remove('hidden');
            modalError.classList.add('hidden');
            feedbackModal.classList.remove('hidden');
        }
        function showErrorModal(message) {
            modalErrorMessage.textContent = message;
            modalLoading.classList.add('hidden');
            modalSuccess.classList.add('hidden');
            modalError.classList.remove('hidden');
            feedbackModal.classList.remove('hidden');
        }
        function hideModal() {
            feedbackModal.classList.add('hidden');
        }
        modalCloseBtn.addEventListener('click', hideModal);
        modalErrorCloseBtn.addEventListener('click', hideModal);

        // --- Form Submit (MODIFIKASI) ---
        async function handleFormSubmit(event, collectionName) {
            event.preventDefault(); 
            if (!db) {
                showErrorModal("Koneksi database gagal. Cek konsol.");
                return;
            }

            const form = event.target;
            const submitButtons = form.querySelectorAll('button[type="submit"]');
            
            // ==================================
            // MODIFIKASI: Blok Validasi 300 Kata
            // ==================================
            const MIN_WORDS = 300;
            if (collectionName === 'wawancara_guru' || collectionName === 'fgd') {
                let isValid = true;
                let firstInvalidField = null;
                
                // Tentukan kontainer textarea berdasarkan nama koleksi
                const containerId = (collectionName === 'wawancara_guru') ? 'wawancara-guru-questions' : 'fgd-questions';
                const textareas = form.querySelectorAll(`#${containerId} textarea`);
                
                textareas.forEach(textarea => {
                    const words = countWords(textarea.value);
                    if (words < MIN_WORDS) {
                        isValid = false;
                        // Tandai sebagai tidak valid (merah)
                        textarea.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                        textarea.classList.remove('border-gray-300', 'focus:border-blue-500', 'focus:ring-blue-500', 'border-green-500', 'focus:border-green-500', 'focus:ring-green-500');

                        if (!firstInvalidField) {
                            firstInvalidField = textarea;
                        }
                    } else {
                        // Tandai sebagai valid (hijau)
                        textarea.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
                        textarea.classList.add('border-green-500', 'focus:border-green-500', 'focus:ring-green-500');
                    }
                });

                if (!isValid) {
                    showErrorModal(`Validasi Gagal. Harap pastikan semua jawaban diisi minimal ${MIN_WORDS} kata. Bidang yang ditandai merah belum memenuhi syarat.`);
                    if (firstInvalidField) {
                        // Fokus dan scroll ke bidang pertama yang salah
                        firstInvalidField.focus();
                        firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    return; // Hentikan proses submit
                }
            }
            // ==================================
            // AKHIR BLOK VALIDASI
            // ==================================

            submitButtons.forEach(btn => btn.disabled = true);
            showLoadingModal();

            try {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                data.createdAt = serverTimestamp();

                const docRef = await addDoc(collection(db, collectionName), data);

                showSuccessModal();
                form.reset(); 
                
                // MODIFIKASI: Reset manual counter dan border setelah sukses
                if (collectionName === 'wawancara_guru' || collectionName === 'fgd') {
                    const containerId = (collectionName === 'wawancara_guru') ? 'wawancara-guru-questions' : 'fgd-questions';
                    const textareas = form.querySelectorAll(`#${containerId} textarea`);
                    
                    textareas.forEach(textarea => {
                        // Reset border
                        textarea.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500', 'border-green-500', 'focus:border-green-500', 'focus:ring-green-500');
                        textarea.classList.add('border-gray-300', 'focus:border-blue-500', 'focus:ring-blue-500');
                        
                        // Reset counter
                        const counterId = 'counter_' + textarea.id;
                        const counterEl = document.getElementById(counterId);
                        if (counterEl) {
                            counterEl.textContent = '0 kata';
                            counterEl.classList.remove('text-red-600', 'text-green-600');
                        }
                    });
                }
                
                const schoolSelector = form.querySelector('select[id^="schoolSelector_"]');
                if (schoolSelector) {
                    schoolSelector.value = "";
                }

            } catch (error) {
                console.error("Error adding document: ", error);
                showErrorModal(error.message);
            } finally {
                submitButtons.forEach(btn => btn.disabled = false);
            }
        }

        // ==================================
        // LOGIKA LOGIN (Tidak Berubah)
        // ==================================
        function populateLoginModal() {
            if (allSekolahData.length === 0) {
                document.getElementById('login-error').textContent = 'Gagal memuat data sekolah.';
                return;
            }
            const provinces = [...new Set(allSekolahData.map(s => s.provinsi).filter(Boolean))].sort();
            const provSelect = document.getElementById('login-provinsi');
            provSelect.innerHTML = '<option value="">Pilih Provinsi</option>';
            provinces.forEach(p => {
                provSelect.appendChild(new Option(p, p));
            });
        }

        function setupLoginListeners() {
            const provSelect = document.getElementById('login-provinsi');
            const kotaSelect = document.getElementById('login-kab-kota');
            const kotaWrapper = document.getElementById('login-kab-kota-wrapper');
            const loginButton = document.getElementById('login-button');
            const loginError = document.getElementById('login-error');

            provSelect.addEventListener('change', () => {
                const selectedProv = provSelect.value;
                kotaSelect.innerHTML = '<option value="">Pilih Kab/Kota</option>';
                kotaWrapper.classList.add('hidden');
                loginButton.disabled = true;
                loginError.textContent = '';

                if (selectedProv) {
                    const cities = [...new Set(
                        allSekolahData
                            .filter(s => s.provinsi === selectedProv)
                            .map(s => s.kota)
                            .filter(Boolean)
                    )].sort();
                    
                    cities.forEach(c => {
                        kotaSelect.appendChild(new Option(c, c));
                    });
                    kotaWrapper.classList.remove('hidden');
                }
            });

            kotaSelect.addEventListener('change', () => {
                const selectedKota = kotaSelect.value;
                loginError.textContent = '';

                if (selectedKota) {
                    loginButton.disabled = false; 
                } else {
                    loginButton.disabled = true;
                }
            });

            loginButton.addEventListener('click', async () => {
                const selectedProv = provSelect.value;
                const selectedKota = kotaSelect.value;

                if (!selectedKota) {
                    loginError.textContent = 'Harap pilih Kab/Kota.';
                    return;
                }

                loginButton.disabled = true;
                loginError.textContent = '';
                
                console.log("Login (filter) berhasil.");
                
                const filteredSekolahData = allSekolahData.filter(s => 
                    s.provinsi === selectedProv && s.kota === selectedKota
                );
                
                allSekolahData = filteredSekolahData;

                if (allSekolahData.length > 0) {
                            populatePetugasDropdowns(); 
                            createSchoolSelectors();  
                        } else {
                    console.warn("Login berhasil, namun tidak ada data sekolah untuk area ini.");
                    populatePetugasDropdowns(); 
                            createSchoolSelectors();
                        }

                document.getElementById('login-modal').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                
                setDefaultForm();

            });
        }

        function setupMainFormSubmitListeners() {
            const formWawancaraGuru = document.getElementById('form-wawancara-guru');
            const formFGD = document.getElementById('form-fgd');
            const formWawancaraMurid = document.getElementById('form-wawancara-murid');
            const formObservasi = document.getElementById('form-observasi');

            if (formWawancaraGuru) {
                formWawancaraGuru.addEventListener('submit', (e) => handleFormSubmit(e, 'wawancara_guru'));
            }
            if (formFGD) {
                formFGD.addEventListener('submit', (e) => handleFormSubmit(e, 'fgd'));
            }
            if (formWawancaraMurid) {
                formWawancaraMurid.addEventListener('submit', (e) => handleFormSubmit(e, 'wawancara_murid'));
            }
            if (formObservasi) {
                formObservasi.addEventListener('submit', (e) => handleFormSubmit(e, 'observasi'));
            }
        }


        // ==================================
        // INISIALISASI UTAMA (MODIFIKASI)
        // ==================================
        
        async function initializeAppCore() {
            populateAllForms();
            
            // MODIFIKASI: Panggil setupWordCounters setelah form dibuat
            setupWordCounters();
            
            await fetchData();
            
            if (allSekolahData.length > 0) {
                populateLoginModal();
            } else {
                console.error("Tidak ada data sekolah, dropdown tidak dapat diisi.");
                document.getElementById('login-error').textContent = 'Gagal memuat data. Silakan refresh.';
            }

            setupLoginListeners();
            setupMainFormSubmitListeners();
        }

        document.addEventListener('DOMContentLoaded', initializeAppCore);

    </script>

</body>
</html>
